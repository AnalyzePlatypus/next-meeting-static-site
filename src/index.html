<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NextMeeting for SA</title>    

  <!-- CSS -->
  <!-- TAILWIND_DEV -->  
  <!-- JS_INLINE -->

  <style>
    [x-cloak] { display: none; }
  </style>

  <script>

    /* INJECT_BUILD_INFO */
    /* INJECT_SCHEDULE_JSON */ 

    if(JSON_SCHEDULE === undefined) {
      window.TEMPLATE_NOT_BUILT = true;
    }

    var MEETINGS_BY_TIME = window.categorizeSessions(JSON_SCHEDULE.meetings);

    // const MILLISECONDS_IN_MINUTE = 1000 * 60;

    // From https://stackoverflow.com/a/10797177/6068782
    function repeatEvery(func, interval) {
      // Check current time and calculate the delay until next interval
      var now = new Date(),
          delay = interval - now % interval;

      function start() {
          // Execute function now...
          func();
          // ... and every interval
          setInterval(func, interval);
      }

      // Delay execution until it's an even interval
      setTimeout(start, delay);
    }

    const ONE_MINUTE_IN_MS = 60 * 1000;
 

    function getLocalTimeFromDateString(dateString) {
      const date = new Date(dateString);
      return date.toLocaleTimeString(undefined, {hour: "2-digit", minute: "2-digit" });
    }
    window.getLocalTimeFromDateString = getLocalTimeFromDateString;

    function getLocalDayOfWeekFromDateString(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString(undefined, {weekday: 'long'});
    }
    window.getLocalTimeFromDateString = getLocalTimeFromDateString;


    window.sessionCategories = [
      {
        title: "Live Now",
        categoryPath: ["past", "newerThanThreshold"],
        emptyUIString: "There are no meetings in progress right now"
      },
      {
        title: "Next Hour",
        categoryPath: ["future", "nextHour"], 
        emptyUIString: "There are no meetings in the next hour",
        hideIfEmpty: true
      },
      {
        title: "Later Today",
        categoryPath: ["future", "restOfDay"], 
        emptyUIString: "There are no more meetings today",
        hideIfEmpty: true
      },
      {
        title: "Tomorrow",
        categoryPath: ["future", "tomorrow"], 
        emptyUIString: "There are no meetings tomorrow",
        hideIfEmpty: true
      },
      {
        title: "Upcoming",
        categoryPath: ["future", "other"], 
        emptyUIString: "There are no upcoming meetings",
        hideIfEmpty: true
      }
    ];

    function getCurrentTimeZoneString() {
      return new Date().toString().match(/([A-Z]+[\+-][0-9]+.*)/)[1];
    }

    const BLANK_SESSION = {
      "name": "",
      "nextOccurrence": new Date().toISOString(),
      "connectionDetails": {
        "platform": "zoom",
        "mustContactForConnectionInfo": false,
        "meetingId": "",
        "password": "",
        "joinUrl": "https://zoom.us"
      },
      "notes": "",
      "participantCount": "",
      "durationMinutes": 60,
      "metadata": {
        "hostLocation": "",
        "language": "en",
        "fellowship": "sa",
        "restrictions": {
          "openMeeting": false,
          "gender": "ALL"
        }
      }
    };
  </script>

  <script>
    /*!
 * swiped-events.js - v1.1.4
 * Pure JavaScript swipe events
 * https://github.com/john-doherty/swiped-events
 * @inspiration https://stackoverflow.com/questions/16348031/disable-scrolling-when-touch-moving-certain-element
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */
!function(t,e){"use strict";"function"!=typeof t.CustomEvent&&(t.CustomEvent=function(t,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var a=e.createEvent("CustomEvent");return a.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),a},t.CustomEvent.prototype=t.Event.prototype),e.addEventListener("touchstart",function(t){if("true"===t.target.getAttribute("data-swipe-ignore"))return;s=t.target,r=Date.now(),n=t.touches[0].clientX,a=t.touches[0].clientY,u=0,i=0},!1),e.addEventListener("touchmove",function(t){if(!n||!a)return;var e=t.touches[0].clientX,r=t.touches[0].clientY;u=n-e,i=a-r},!1),e.addEventListener("touchend",function(t){if(s!==t.target)return;var e=parseInt(l(s,"data-swipe-threshold","20"),10),o=parseInt(l(s,"data-swipe-timeout","500"),10),c=Date.now()-r,d="",p=t.changedTouches||t.touches||[];Math.abs(u)>Math.abs(i)?Math.abs(u)>e&&c<o&&(d=u>0?"swiped-left":"swiped-right"):Math.abs(i)>e&&c<o&&(d=i>0?"swiped-up":"swiped-down");if(""!==d){var b={dir:d.replace(/swiped-/,""),xStart:parseInt(n,10),xEnd:parseInt((p[0]||{}).clientX||-1,10),yStart:parseInt(a,10),yEnd:parseInt((p[0]||{}).clientY||-1,10)};s.dispatchEvent(new CustomEvent("swiped",{bubbles:!0,cancelable:!0,detail:b})),s.dispatchEvent(new CustomEvent(d,{bubbles:!0,cancelable:!0,detail:b}))}n=null,a=null,r=null},!1);var n=null,a=null,u=null,i=null,r=null,s=null;function l(t,n,a){for(;t&&t!==e.documentElement;){var u=t.getAttribute(n);if(u)return u;t=t.parentNode}return a}}(window,document);
  </script>

</head>
  <body> 
    <div class="main-nav">
      <a href="/"> 
        <h1 class="logo light"><span class="bold">Next</span><span>Meeting</span> <span>for <strong>SA<strong></strong></span></h1>
      </a> 
    </div>

    <!-- <h4 class="text-xs uppercase flex flex-col items-center mt-4 opacity-50 mb-8">
     
    </h4> -->
    
    <!-- <div class="flex flex-col items-center x-cloak" x-data={}>
      <div class="session-card inset flex flex-col items-center my-8" x-show="!JSON_SCHEDULE">
        <h1 class="text-xl">Template file</h1>
        <p>This file has not been populated with the schedule by the build system yet.</p>
      </div>
     </div> -->

  </div>

    <div x-cloak x-data="{  
      MEETINGS_BY_TIME,
      meetings: JSON_SCHEDULE.meetings, 
      virtualPage: 'home', 
      selectedSession: BLANK_SESSION,
      closeSessionDetailsModal() {
        this.virtualPage = 'home';
        this.sessionDetails=BLANK_SESSION;
        bodyScrollLock.clearAllBodyScrollLocks();
      },
      recategorizeSessions() {
        // Recalculate all meeting times every minute
        // So sessions can move up to the next category, become/exit being live, etc.
        console.log('Recalulating dates');
        this.MEETINGS_BY_TIME = window.categorizeSessions(this.meetings.slice(0, this.amountRemaining));
      },
    }"
    x-init="
      document.querySelector('#session-details-card').addEventListener('swiped-down', function(e) {
        closeSessionDetailsModal()
      });
      repeatEvery(()=> { 
        recategorizeSessions();
      }, ONE_MINUTE_IN_MS); 
    "
    >
    <script>
    </script>
        <div class="swipeable-bottom-sheet">
          <div class="bg" :class="{'active': virtualPage === 'sessionDetails'}" @click="closeSessionDetailsModal()"></div>

          <div class="card" 
            id="session-details-card"
            x-show="virtualPage === 'sessionDetails'"
            @click.away="closeSessionDetailsModal()"
            >
            <div class="mt-2">
              <div class="bar"></div>

              <div class="mx-6 mt-4">
                <div class="mt-4 flex items-center uppercase">
                  <div class="badge-live mr-2" x-show="selectedSession.nextOccurrence < CURRENT_TIME_STRING">Live</div>
                  <div class="session-time-relative text-color-3 tracking-wide text-xs">
                    <span x-text="selectedSession.nextOccurrence < CURRENT_TIME_STRING ? 'started' : 'starting'"></span>
                    <span class="text-primary" x-text="timeDifference(new Date(), selectedSession.nextOccurrence, {displayMode: 'full', sign: 'text'})"></span>
                  </div>
                </div>
                <h3 class="session-title text-color-1 text-2xl leading-tight mt-2 mb-1" x-text="selectedSession.name"></h3>
                <div class="text-color-2 opacity-75 text-xs">
                  <span>
                    Every 
                    <span x-text="getLocalDayOfWeekFromDateString(selectedSession.nextOccurrence)"></span>
                  </span>
                  <span>•</span>
                  <span x-text="getLocalTimeFromDateString(selectedSession.nextOccurrence)"></span>
                </div>
              </div>

              <div class="mt-4 mx-6 flex justify-between">
                <button id="selected-session-copy-link-button" class="hidden sm:flexbutton medium borderless button-divider" :data-clipboard-text="selectedSession.connectionDetails.joinUrl">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link-2"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg>
                  <span class="ml-1">Copy&nbsp;Link</span>
                </button>

                <button id="selected-session-copy-details-button"class="button medium borderless" :data-clipboard-text="'Join ' + selectedSession.name + (selectedSession.nextOccurrence < CURRENT_TIME_STRING ? ', started ' : ', starting ') + (timeDifference(new Date(), selectedSession.nextOccurrence, {displayMode: 'full', sign: 'text'})) + '\n' + selectedSession.connectionDetails.joinUrl + '\n' + 'Meeting ID: ' + selectedSession.connectionDetails.meetingId + '\nPassword: ' + selectedSession.connectionDetails.password">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                  <span class="ml-1">Copy&nbsp;Details</span>
                </button>
      
                <a
                  id="selected-session-join-url"
                  :href="selectedSession.connectionDetails.joinUrl"
                  class="button button-primary large mr-1 px-6 sm:px-2">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-video"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>
                  <span class="mx-2">Join&nbsp;›</span>
                </a>
              </div>

            </div>

            <div class="mt-3 px-6 py-3 text-xl background-light">
              <div class="mb-4 flex justify-between">
                <strong class="mr-2">Zoom ID</strong>
                <div class="text-primary" x-text="selectedSession.connectionDetails.meetingId">123 456 890</div>
              </div>
              <div class="flex justify-between">
                <strong class="mr-2">Password</strong>
                <div class="text-primary" x-text="selectedSession.connectionDetails.password">2020</div>
              </div>
            </div>

            <div class="mx-6 mt-3">
              <h4 class="uppercase text-color-2 mb-1 mt-2 text-sm">Contact</h4>
              <div x-text="selectedSession.contactInfo" class=""></div>
              <div x-show="!selectedSession.contactInfo" class="opacity-75">
                🤷‍♂️ No contact info provided. 
              </div>
            </div>

            <div class="w-full flex flex-col items-center">
              <a href="mailto:sanewsenglish@gmail.com" class="button-secondary medium transform translate-y-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                <span class="ml-2">Send&nbsp;Feedback</span>
              </a>

              <div class="accent-color-bar"></div>
            </div>
          </div>
        </div>


      <template x-for="(category, index) in window.sessionCategories">
 
        <section class="session-group" x-show="MEETINGS_BY_TIME[category.categoryPath[0]][category.categoryPath[1]].length > 0 || !category.hideIfEmpty">

          <div class="flex justify-center mb-2">
            <h2 class="session-group__title" x-text="category.title"></h2>
          </div>
        
          <div class="w-full flex flex-col items-center" x-show="MEETINGS_BY_TIME[category.categoryPath[0]][category.categoryPath[1]].length > 0">
            <template x-for="(session, index) in MEETINGS_BY_TIME[category.categoryPath[0]][category.categoryPath[1]]" :key="index">
              <!-- SESSION_CARD -->
            </template> 
          </div> 
    
          <div x-show="MEETINGS_BY_TIME[category.categoryPath[0]][category.categoryPath[1]].length == 0">
           <div class="session-card inset flex justify-center items-center ">
             <h2 x-text="category.emptyUIString" class="text-center mr-6 text-sm"></h2>
           </div>
          </div>
        </section>
      </template> 
    </div>


    <div x-cloak x-data="{}" class="text-xs uppercase flex flex-col items-center mt-6 opacity-50 mb-6">
      <h4>
        <span>Showing meetings in</span>
        <span class="text-primary">Next 24 Hours</span>
      </h4> 
      <h4>
        <span>Timezone</span>
        <span class="text-primary" x-text="getCurrentTimeZoneString()"></span>
      </h4>

      <h4 class="mt-2">
        <span x-text="(window.BUILD_INFO.buildType == 'prod' ? 'Production' : 'Development') + ' build'"></span>
        <span x-text="(window.BUILD_INFO.commitHash && window.BUILD_INFO.commitHash.length > 0) ? ' ' + window.BUILD_INFO.commitHash.substring(0,6) : ''" class="text-primary"></span>
      </h4>
      <h4>
        <span>Deployed </span>
        <span class="text-primary" x-text="timeDifference(new Date(), window.BUILD_INFO.builtAt, {displayMode: 'full', sign: 'text'})"></span>
      </h4>
    </div>
  </body>
  <footer>
    <!-- JS_LIBS -->  
    <script>
      const clipboardButtonElems = [
        ,
        // "#selected-session-copy-details-button"
      ];

      console.log(clipboardButtonElems);
      new ClipboardJS("#selected-session-copy-link-button", {
        text: function(trigger) {
          return trigger.getAttribute('data-clipboard-text');
        }
      }).on('success', function(e) {
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);

        e.clearSelection();
    });


    new ClipboardJS("#selected-session-copy-details-button", {
      text: function(trigger) {
        return trigger.getAttribute('data-clipboard-text');
      }
    }).on('success', function(e) {
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);

        e.clearSelection();
    });
    </script>
    <!-- FONTS -->
  </footer>
</html>